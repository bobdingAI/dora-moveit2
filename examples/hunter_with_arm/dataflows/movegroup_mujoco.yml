# MoveGroup API + Hunter SE + MuJoCo Simulation
# ================================================
# High-level MoveGroup API (similar to ROS MoveIt MoveGroupCommander)
#
# Usage:
#   cd examples/hunter_with_arm
#   dora start dataflows/movegroup_mujoco.yml

nodes:
  # ===========================================
  # MuJoCo Simulation
  # ===========================================
  - id: mujoco_sim
    path: ../../../dora-mujoco/dora_mujoco/main.py
    inputs:
      tick: dora/timer/millis/10
      control_input: trajectory_executor/joint_commands
    outputs:
      - joint_positions
      - joint_velocities
      - sensor_data
    env:
      MODEL_NAME: "/home/demo/Downloads/dora-moveit/examples/hunter_with_arm/models/hunter_se_with_arm_and_pipes.xml"
      MUJOCO_GL: "glfw"

  # ===========================================
  # Planning Scene (library operator)
  # ===========================================
  - id: planning_scene
    path: ../hunter_arm_demo/nodes/planning_scene.py
    inputs:
      robot_state: mujoco_sim/joint_positions
      scene_command: user_node/scene_command
      tick: dora/timer/millis/5000
    outputs:
      - scene_update
      - command_result
    env:
      ROBOT_CONFIG_MODULE: "hunter_arm_demo.config.gen72"

  # ===========================================
  # OMPL Motion Planner (library operator)
  # ===========================================
  - id: planner
    path: ../hunter_arm_demo/nodes/planner.py
    inputs:
      plan_request: user_node/plan_request
      scene_update: planning_scene/scene_update
    outputs:
      - trajectory
      - plan_status
    env:
      ROBOT_CONFIG_MODULE: "hunter_arm_demo.config.gen72"

  # ===========================================
  # IK Solver (library operator)
  # ===========================================
  - id: ik_solver
    path: ../hunter_arm_demo/nodes/ik_solver.py
    inputs:
      ik_request: user_node/ik_request
    outputs:
      - ik_solution
      - ik_status
    env:
      ROBOT_CONFIG_MODULE: "hunter_arm_demo.config.gen72"

  # ===========================================
  # Trajectory Executor (library operator)
  # ===========================================
  - id: trajectory_executor
    path: ../hunter_arm_demo/nodes/trajectory_executor.py
    inputs:
      trajectory: planner/trajectory
      joint_positions: mujoco_sim/joint_positions
      tick: dora/timer/millis/50
    outputs:
      - joint_commands
      - execution_status
    env:
      ROBOT_CONFIG_MODULE: "hunter_arm_demo.config.gen72"

  # ===========================================
  # Vehicle Controller (app-specific)
  # ===========================================
  - id: vehicle_controller
    path: ../hunter_arm_demo/nodes/vehicle_controller.py
    inputs:
      joint_positions: mujoco_sim/joint_positions
    outputs:
      - wheel_commands
      - movement_complete

  # ===========================================
  # User Node (MoveGroup API example script)
  # ===========================================
  - id: user_node
    path: ../hunter_arm_demo/nodes/example_movegroup.py
    inputs:
      joint_positions: mujoco_sim/joint_positions
      execution_status: trajectory_executor/execution_status
      trajectory: planner/trajectory
      plan_status: planner/plan_status
      ik_solution: ik_solver/ik_solution
      ik_status: ik_solver/ik_status
      command_result: planning_scene/command_result
      vehicle_ready: vehicle_controller/movement_complete
    outputs:
      - robot_state
      - plan_request
      - ik_request
      - scene_command
    env:
      ROBOT_CONFIG_MODULE: "hunter_arm_demo.config.gen72"
